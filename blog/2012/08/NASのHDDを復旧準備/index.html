

<!DOCTYPE html>
<html lang="ja">
<head>
  
    
      <script async src="https://www.googletagmanager.com/gtag/js?id=G-EB1NSD9DCG"></script>
      <script>
        var doNotTrack = false;
        if ( false ) {
          var dnt = (navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack);
          var doNotTrack = (dnt == "1" || dnt == "yes");
        }
        if (!doNotTrack) {
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());
          gtag('config', 'G-EB1NSD9DCG');
        }
      </script>
    
  

<meta charset="UTF-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="robots" content="index, follow">
<meta name="revisit-after" content="15 days"><link rel="author" href="https://github.pyyoshi.com/blog/humans.txt">
<link rel="apple-touch-icon" sizes="180x180" href="https://github.pyyoshi.com/blog/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://github.pyyoshi.com/blog/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://github.pyyoshi.com/blog/favicon-16x16.png">
<link rel="manifest" href="https://github.pyyoshi.com/blog/site.webmanifest">
<meta name="msapplication-TileImage" content="/mstile-144x144.png">
<meta name="theme-color" content="#494f5c">
<meta name="msapplication-TileColor" content="#494f5c">
<link rel="mask-icon" href="https://github.pyyoshi.com/blog/safari-pinned-tab.svg" color="#494f5c"><meta name="author" content="PyYoshi">

  <meta itemprop="name" content="NASのHDDを復旧準備">
  <meta itemprop="description" content="ここ最近調子が悪いNAS。 そしておいておいたファイルがデバイスエラーで読み込めなくなってしまった。
ファイルシステムがXFSという事もあってLinux機につないで作業を行った。
まずマウントできるか試した。
$sudo mkdir /mnt/nas
$sudo mount -t xfs /dev/sdc1 /mnt/nas
SuperBlockがどうのこうのというよくわからないエラーが出た。
調べてみるとxfsprogsでなんとかなるかもしれないらしい。
$sudo apt-get install xfsprogs
$sudo reboot
バックアップの作成
$sudo mkdir /mnt/tmp
$sudo dd if=/dev/sdc1 of=/mnt/tmp/broken.img ibs=512 obs=1024k conv=noerror,sync
$sudo xfs_check /dev/sdc1
found candidate secondary superblock…
verified secondary superblock…
writing modified primary superblock
sb root inode value 18446744073709551615 (NULLFSINO) inconsistent with calculated value 128
resetting superblock root inode pointer to 128
sb realtime bitmap inode 18446744073709551615 (NULLFSINO) inconsistent with calculated value 129">
  <meta itemprop="datePublished" content="2012-08-07T06:59:00+09:00">
  <meta itemprop="dateModified" content="2012-08-07T06:59:00+09:00">
  <meta itemprop="wordCount" content="202">
  <meta itemprop="keywords" content="Xfs,Nas"><meta property="og:url" content="https://github.pyyoshi.com/blog/2012/08/NAS%E3%81%AEHDD%E3%82%92%E5%BE%A9%E6%97%A7%E6%BA%96%E5%82%99/">
  <meta property="og:site_name" content="PyYoshiのログ置き場">
  <meta property="og:title" content="NASのHDDを復旧準備">
  <meta property="og:description" content="ここ最近調子が悪いNAS。 そしておいておいたファイルがデバイスエラーで読み込めなくなってしまった。
ファイルシステムがXFSという事もあってLinux機につないで作業を行った。
まずマウントできるか試した。
$sudo mkdir /mnt/nas
$sudo mount -t xfs /dev/sdc1 /mnt/nas
SuperBlockがどうのこうのというよくわからないエラーが出た。
調べてみるとxfsprogsでなんとかなるかもしれないらしい。
$sudo apt-get install xfsprogs
$sudo reboot
バックアップの作成
$sudo mkdir /mnt/tmp
$sudo dd if=/dev/sdc1 of=/mnt/tmp/broken.img ibs=512 obs=1024k conv=noerror,sync
$sudo xfs_check /dev/sdc1
found candidate secondary superblock…
verified secondary superblock…
writing modified primary superblock
sb root inode value 18446744073709551615 (NULLFSINO) inconsistent with calculated value 128
resetting superblock root inode pointer to 128
sb realtime bitmap inode 18446744073709551615 (NULLFSINO) inconsistent with calculated value 129">
  <meta property="og:locale" content="ja">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2012-08-07T06:59:00+09:00">
    <meta property="article:modified_time" content="2012-08-07T06:59:00+09:00">
    <meta property="article:tag" content="Xfs">
    <meta property="article:tag" content="Nas">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="NASのHDDを復旧準備">
  <meta name="twitter:description" content="ここ最近調子が悪いNAS。 そしておいておいたファイルがデバイスエラーで読み込めなくなってしまった。
ファイルシステムがXFSという事もあってLinux機につないで作業を行った。
まずマウントできるか試した。
$sudo mkdir /mnt/nas
$sudo mount -t xfs /dev/sdc1 /mnt/nas
SuperBlockがどうのこうのというよくわからないエラーが出た。
調べてみるとxfsprogsでなんとかなるかもしれないらしい。
$sudo apt-get install xfsprogs
$sudo reboot
バックアップの作成
$sudo mkdir /mnt/tmp
$sudo dd if=/dev/sdc1 of=/mnt/tmp/broken.img ibs=512 obs=1024k conv=noerror,sync
$sudo xfs_check /dev/sdc1
found candidate secondary superblock…
verified secondary superblock…
writing modified primary superblock
sb root inode value 18446744073709551615 (NULLFSINO) inconsistent with calculated value 128
resetting superblock root inode pointer to 128
sb realtime bitmap inode 18446744073709551615 (NULLFSINO) inconsistent with calculated value 129">
<title>NASのHDDを復旧準備</title>
<link rel="stylesheet dns-prefetch preconnect preload prefetch" as="style" href="https://github.pyyoshi.com/blog/css/style.min.53a53ff9a700cf26a907d20cff4ca6268650da3c0980ef01164d230678d732e7.css" integrity="sha256-U6U/+acAzyapB9IM/0ymJoZQ2jwJgO8BFk0jBnjXMuc=" crossorigin="anonymous">
	</head>
<body id="page">
	<header id="site-header" class="animated slideInUp">
		<div class="hdr-wrapper section-inner">
			<div class="hdr-left">
				<div class="site-branding">
					<a href="https://github.pyyoshi.com/blog/">PyYoshiのログ置き場</a>
				</div>
				<nav class="site-nav hide-in-mobile"><a href="https://github.pyyoshi.com/blog/posts/">Posts(Ja)</a><a href="https://github.pyyoshi.com/blog/pages/">Pages</a></nav>
			</div>
			<div class="hdr-right hdr-icons">
				<span class="hdr-social hide-in-mobile"><a href="https://twitter.com/PyYoshi" target="_blank" rel="noopener me" title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a><a href="https://github.com/PyYoshi" target="_blank" rel="noopener me" title="Github"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></a></span><button id="share-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-share-2"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line></svg></button>
 
<div id="share-links" class="animated fast">
    
    
    
    
    <ul>
        <li>
            <a href="https://twitter.com/intent/tweet?hashtags=hermit2&amp;url=https%3a%2f%2fgithub.pyyoshi.com%2fblog%2f2012%2f08%2fNAS%25E3%2581%25AEHDD%25E3%2582%2592%25E5%25BE%25A9%25E6%2597%25A7%25E6%25BA%2596%25E5%2582%2599%2f&amp;text=NAS%e3%81%aeHDD%e3%82%92%e5%be%a9%e6%97%a7%e6%ba%96%e5%82%99" target="_blank" rel="noopener" aria-label="Share on X"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path class="st0" d="m21.3 21.1 -11.4 -18.2h-7.2l11.4 18.2zm-18.6 0 7.2 -6.6m4.2 -5 7.2 -6.6"/></svg></a>
        </li>
        <li>
            <a href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fgithub.pyyoshi.com%2fblog%2f2012%2f08%2fNAS%25E3%2581%25AEHDD%25E3%2582%2592%25E5%25BE%25A9%25E6%2597%25A7%25E6%25BA%2596%25E5%2582%2599%2f" target="_blank" rel="noopener" aria-label="Share on Facebook"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a>
        </li>
        <li>
            <a href="mailto:?subject=NAS%e3%81%aeHDD%e3%82%92%e5%be%a9%e6%97%a7%e6%ba%96%e5%82%99&amp;body=https%3a%2f%2fgithub.pyyoshi.com%2fblog%2f2012%2f08%2fNAS%25E3%2581%25AEHDD%25E3%2582%2592%25E5%25BE%25A9%25E6%2597%25A7%25E6%25BA%2596%25E5%2582%2599%2f" target="_self" rel="noopener" aria-label="Share on Email"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></a>
        </li>
        <li>
            <a href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fgithub.pyyoshi.com%2fblog%2f2012%2f08%2fNAS%25E3%2581%25AEHDD%25E3%2582%2592%25E5%25BE%25A9%25E6%2597%25A7%25E6%25BA%2596%25E5%2582%2599%2f&amp;source=https%3a%2f%2fgithub.pyyoshi.com%2fblog%2f&amp;title=NAS%e3%81%aeHDD%e3%82%92%e5%be%a9%e6%97%a7%e6%ba%96%e5%82%99&amp;summary=NAS%e3%81%aeHDD%e3%82%92%e5%be%a9%e6%97%a7%e6%ba%96%e5%82%99%2c%20by%20PyYoshi%0a%0a%3cnil%3e%0a" target="_blank" rel="noopener" aria-label="Share on LinkedIn"><svg xmlns="http://www.w3.org/2000/svg" class="feather" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></a>
        </li>
        <li>
            <a href="#" onclick="linkShare(&#34;NASのHDDを復旧準備&#34;,&#34;https://github.pyyoshi.com/blog/2012/08/NAS%E3%81%AEHDD%E3%82%92%E5%BE%A9%E6%97%A7%E6%BA%96%E5%82%99/&#34;,&#34;NASのHDDを復旧準備, by PyYoshi\n\n\u003cnil\u003e\n&#34;); return false;" target="_self" rel="noopener" aria-label="Copy Link"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-copy"><rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect><path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path></svg></a>
        </li>
    </ul>
</div><button id="menu-btn" class="hdr-btn" title=""><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"><line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line></svg></button>
			</div>
		</div>
	</header>
	<div id="mobile-menu" class="animated fast">
		<ul>
			<li><a href="https://github.pyyoshi.com/blog/posts/">Posts(Ja)</a></li>
			<li><a href="https://github.pyyoshi.com/blog/pages/">Pages</a></li>
		</ul>
	</div>


	<main class="site-main section-inner animated fadeIn faster"><article class="thin">
			<header class="post-header">
				<div class="post-meta"><span>Aug 7, 2012</span></div>
				<h1>NASのHDDを復旧準備</h1>
			</header>
			<div class="post-info"><p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-feather"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"></path><line x1="16" y1="8" x2="2" y2="22"></line><line x1="17.5" y1="15" x2="9" y2="15"></line></svg><a href="" target="_blank">PyYoshi</a></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg><span class="tag"><a href="https://github.pyyoshi.com/blog/tags/xfs">xfs</a></span><span class="tag"><a href="https://github.pyyoshi.com/blog/tags/nas">nas</a></span></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg></p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>2012-08-07 06:59 &#43;0900</p></div>
			<hr class="post-end">
			<div class="content">
				<p>ここ最近調子が悪いNAS。
そしておいておいたファイルがデバイスエラーで読み込めなくなってしまった。</p>
<p>ファイルシステムがXFSという事もあってLinux機につないで作業を行った。<br>
<!-- raw HTML omitted --><!-- raw HTML omitted --><br>
まずマウントできるか試した。</p>
<p>$sudo mkdir /mnt/nas</p>
<p>$sudo mount -t xfs /dev/sdc1 /mnt/nas</p>
<p>SuperBlockがどうのこうのというよくわからないエラーが出た。</p>
<p>調べてみるとxfsprogsでなんとかなるかもしれないらしい。</p>
<p>$sudo apt-get install xfsprogs</p>
<p>$sudo reboot</p>
<p>バックアップの作成</p>
<p>$sudo mkdir /mnt/tmp</p>
<p>$sudo dd if=/dev/sdc1 of=/mnt/tmp/broken.img ibs=512 obs=1024k
conv=noerror,sync</p>
<p>$sudo xfs_check /dev/sdc1</p>
<blockquote>
<p>found candidate secondary superblock&hellip;<br>
verified secondary superblock&hellip;<br>
writing modified primary superblock<br>
sb root inode value 18446744073709551615 (NULLFSINO) inconsistent with
calculated value 128<br>
resetting superblock root inode pointer to 128<br>
sb realtime bitmap inode 18446744073709551615 (NULLFSINO) inconsistent
with calculated value 129<br>
resetting superblock realtime bitmap ino pointer to 129<br>
sb realtime summary inode 18446744073709551615 (NULLFSINO)
inconsistent with calculated value 130<br>
resetting superblock realtime summary ino pointer to 130<br>
Phase 2 - using internal log<br>
        - zero log&hellip;<br>
ERROR: The filesystem has valuable metadata changes in a log which
needs to<br>
be replayed.  Mount the filesystem to replay the log, and unmount it
before<br>
re-running xfs_repair.  If you are unable to mount the filesystem,
then use<br>
the -L option to destroy the log and attempt a repair.<br>
Note that destroying the log may cause corruption &ndash; please attempt a
mount<br>
of the filesystem before doing this.</p>
</blockquote>
<p>xfs_checkでかなり時間がかかります。
なにやらSuperBlockを探しているみたい。</p>
<p>それでもってエラー…</p>
<p>-Lオプション付けて再度実行しろと言われた。
しかももしかしたらデータ消えると…</p>
<p>まぁバックアップしているしっと思い-Lを付けて再実行</p>
<p>$sudo xfs_check -L /dev/sdc1</p>
<p>さくっと終了。</p>
<p>再度マウントしてみる。</p>
<p>$sudo mount -t xfs /dev/sdc1 /mnt/nas</p>
<p>マウントは成功。vncに入りデータ救出した。</p>
<p>おわり</p>
<p>ルータについていたお粗末なNAS機能。</p>
<p>本当にお粗末で録画していたエンコ済み動画を再生するのにかなりもたつきがあった。</p>
<p>NAS自体でフォーマットするより、Linuxなりで正常にフォーマットしてやったほうが良かったのではないかと後悔している。</p>

			</div>
		</article>
		<div class="post-nav thin">
			<a class="next-post" href="https://github.pyyoshi.com/blog/2012/08/%E4%BD%95%E3%81%8B%E4%B8%80%E3%81%A4%E8%87%AA%E8%BA%AB%E3%82%92%E6%8C%81%E3%81%A6%E3%82%8B%E3%82%82%E3%81%AE%E5%BC%B7%E3%81%BF%E3%81%AB%E3%81%AA%E3%82%8B%E3%82%82%E3%81%AE%E3%82%92%E3%82%82%E3%81%A4/">
				<span class="post-nav-label"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-left"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>&nbsp;</span><br><span>何か一つ自身を持てるもの・強みになるものをもつ</span>
			</a>
			<a class="prev-post" href="https://github.pyyoshi.com/blog/2012/08/Windows%E7%92%B0%E5%A2%83%E4%B8%8B%E3%81%A7%E3%82%82VirtualenvWrapper%E3%82%92%E4%BD%BF%E3%81%86/">
				<span class="post-nav-label">&nbsp;<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-arrow-right"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg></span><br><span>Windows環境下でもVirtualenvWrapperを使う</span>
			</a>
		</div>
		<div id="comments" class="thin"></div>
	</main>

<footer id="site-footer" class="section-inner thin animated fadeIn faster">
	<p>
		&copy; 2024 <a href="https://github.pyyoshi.com/blog/"></a>
		&#183; &#183; PyYoshi
		&#183; Made with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a>
		&#183; Theme <a href="https://github.com/1bl4z3r/hermit-V2" target="_blank" rel="noopener">Hermit-V2</a></p>

</footer>
<script async src="https://github.pyyoshi.com/blog/js/bundle.min.c7c384e4d29d192bbac6811ae4660bb01767194a5bea56baca77e8260f93ea16.js" integrity="sha256-x8OE5NKdGSu6xoEa5GYLsBdnGUpb6la6ynfoJg+T6hY=" crossorigin="anonymous"></script><script async src="https://github.pyyoshi.com/blog/js/link-share.min.24409a4f6e5537d70ffc55ec8f9192208d718678cb8638585342423020b37f39.js" integrity="sha256-JECaT25VN9cP/FXsj5GSII1xhnjLhjhYU0JCMCCzfzk=" crossorigin="anonymous"></script>
</body>

</html>
